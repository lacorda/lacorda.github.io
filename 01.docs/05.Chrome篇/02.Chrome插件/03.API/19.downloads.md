---
description: downloads
slug: /674ba06
tags: 
  - downloads
---

# downloads ä¸‹è½½
>
> å¯åŠ¨ã€ç›‘è§†ã€æ“ä½œå’Œæœç´¢ä¸‹è½½ï¼Œæ­¤æƒé™ä¼šè§¦å‘è­¦å‘Š

## æƒé™è®¾ç½®

```json
{
  "permissions": [
    "downloads"
  ],
}
```

## æ–¹æ³•

### setShelfEnabled() è®¾ç½®ä¸‹è½½æ æ˜¯å¦å¯è§
>
> è®¾ç½®ä¸‹è½½æ æ˜¯å¦å¯è§ã€‚åº•éƒ¨ç°è‰²ä¸‹è½½æ ã€‚æ–°ç‰ˆæœ¬ä½¿ç”¨`setUiOptions`

```ts
chrome.downloads.setShelfEnabled(enabled: boolean, callback?: function);
```

### download() ä¸‹è½½é“¾æ¥
>
> ä¸‹è½½æ–‡ä»¶

```ts
// ä¸‹è½½é¡¹ä¿¡æ¯
type downloadItemInfo = {
  // æ›¾ä¸‹è½½æ–‡ä»¶çš„URL
  url: string;
  // æ›¾ä¸‹è½½æ–‡ä»¶çš„æ–‡ä»¶å
  filename: string;
  // æ›¾ä¸‹è½½æ–‡ä»¶çš„ä¿å­˜è·¯å¾„
  saveAs: boolean;
  // æ›¾ä¸‹è½½æ–‡ä»¶çš„è¯·æ±‚å¤´
  headers: object[];
  // æ›¾ä¸‹è½½æ–‡ä»¶çš„è¯·æ±‚ä½“
  body: object;
  // æ›¾ä¸‹è½½æ–‡ä»¶çš„è¯·æ±‚æ–¹æ³•
  method: 'GET' | 'POST';
  // æ›¾ä¸‹è½½æ–‡ä»¶çš„è¯·æ±‚ç±»å‹
  type: 'image' | 'video' | 'audio' | 'text' | 'application' | 'multipart' | 'other';
  // æ›¾ä¸‹è½½æ–‡ä»¶çš„å¤§å°
  totalBytes: number;
  // æ›¾ä¸‹è½½æ–‡ä»¶çš„çŠ¶æ€
  state: 'in_progress' | 'interrupted' | 'complete';
  // æ›¾ä¸‹è½½æ–‡ä»¶çš„çŠ¶æ€ä¿¡æ¯
  paused: boolean;
  // æ›¾ä¸‹è½½æ–‡ä»¶çš„é”™è¯¯ä¿¡æ¯
  error: string;
  // æ›¾ä¸‹è½½æ–‡ä»¶çš„åˆ›å»ºæ—¶é—´
  startTime: number;
  // æ›¾ä¸‹è½½æ–‡ä»¶çš„ç»“æŸæ—¶é—´
  endTime: number;
  // æ›¾ä¸‹è½½æ–‡ä»¶çš„æŒç»­æ—¶é—´
  elapsedTime: number;
  // æ›¾ä¸‹è½½æ–‡ä»¶çš„æœ€åä¿®æ”¹æ—¶é—´
  lastModified: number;
  // æ›¾ä¸‹è½½æ–‡ä»¶çš„æœ€åè®¿é—®æ—¶é—´
  lastAccessed: number;
  // æ›¾ä¸‹è½½æ–‡ä»¶çš„MIMEç±»å‹
  mime: string;
  // æ›¾ä¸‹è½½æ–‡ä»¶çš„SHA1å“ˆå¸Œå€¼
  sha1: string;
  // æ›¾ä¸‹è½½æ–‡ä»¶çš„SHA256å“ˆå¸Œå€¼
  sha256: string;
  // æ›¾ä¸‹è½½æ–‡ä»¶çš„MD5å“ˆå¸Œå€¼
  md5: string;
  // æ›¾ä¸‹è½½æ–‡ä»¶çš„CRC32Cå“ˆå¸Œå€¼
  crc32c: string;
  // æ›¾ä¸‹è½½æ–‡ä»¶çš„å®‰å…¨çŠ¶æ€
  danger: 'safe' | 'accepted' | 'accepted_with_warning' | 'unknown';
  // æ›¾ä¸‹è½½æ–‡ä»¶çš„æ˜¯å¦å¯æ¢å¤
  canResume: boolean;
  // æ›¾ä¸‹è½½æ–‡ä»¶çš„æ˜¯å¦å·²åˆ é™¤
  exists: boolean;
  // æ›¾ä¸‹è½½æ–‡ä»¶çš„æ˜¯å¦å·²æ‰“å¼€
  opened: boolean;
  // æ›¾ä¸‹è½½æ–‡ä»¶çš„æ˜¯å¦å·²ä¿å­˜
  state: 'in_progress' | 'interrupted' | 'complete';
}

chrome.downloads.download(downloadItemInfo: downloadItemInfo, callback?: function);
```

```js
// background.js
chrome.downloads.download({
  url: 'https://www.baidu.com',
  filename: 'baidu.html',
  saveAs: false,
  headers: [],
  body: {},
  method: 'GET',
  type: 'text',
  totalBytes: 0,
  state: 'in_progress',
  paused: false,
  error: '',
  startTime: 0,
  endTime: 0,
  elapsedTime: 0,
  lastModified: 0,
  lastAccessed: 0,
  mime: '',
  sha1: '',
  sha256: '',
  md5: '',
  crc32c: '',
  danger: 'safe',
  canResume: false,
  exists: false,
  opened: false,
}, (downloadItem) => {
  console.log('ğŸ„  background: >>>>>>>>>>>>>>>>>> ä¸‹è½½æ–‡ä»¶', Date.now(), downloadItem);
});
```

### search() æœç´¢
>
> æœç´¢æµè§ˆå™¨æ›¾ç»ä¸‹è½½è¿‡çš„æ‰€æœ‰æ–‡ä»¶

```ts
type DownloadQuery = {
  id: number;

  // æ›¾ä¸‹è½½æ–‡ä»¶çš„URL
  url: string;
  urlRegex: string;
  finalUrl: string;
  finalUrlRegex: string;

  // æ›¾ä¸‹è½½æ–‡ä»¶çš„æ–‡ä»¶å
  filename: string;
  filenameRegex: string;

  // æœç´¢ç»“æœçš„æœ€å¤§æ•°é‡
  limit: number;

  // æœç´¢ç»“æœæ’åºï¼šorderBy = [â€˜ startTimeâ€™]æŒ‰ç…§å¼€å§‹æ—¶é—´å‡åºï¼Œè‹¥è¦æŒ‡å®šé™åºé¡ºåºï¼Œè¯·åœ¨å‰ç¼€ä¸­åŠ ä¸Šè¿å­—ç¬¦: â€œ-startTimeâ€ã€‚
  orderBy: string[];

  // urlé“¾æ¥å‚æ•°
  query: string[];

  // æ›¾ä¸‹è½½æ–‡ä»¶çš„çŠ¶æ€
  state: 'in_progress' | 'interrupted' | 'complete';

  // æ›¾ä¸‹è½½æ–‡ä»¶çš„MIMEç±»å‹
  mime: string;

  // æ›¾ä¸‹è½½æ–‡ä»¶çš„æ˜¯å¦å·²åˆ é™¤
  exists: boolean;

  // æ›¾ä¸‹è½½æ–‡ä»¶çš„çŠ¶æ€ä¿¡æ¯
  paused: boolean;
  // æ›¾ä¸‹è½½æ–‡ä»¶çš„é”™è¯¯ä¿¡æ¯
  error: string;

  // æ›¾ä¸‹è½½æ–‡ä»¶çš„åˆ›å»ºæ—¶é—´
  startTime: number;
  startedAfter: number;
  startedBefore: number;
  // æ›¾ä¸‹è½½æ–‡ä»¶çš„ç»“æŸæ—¶é—´
  endTime: number;
  endedAfter: number;
  endedBefore: number;
  // æ›¾ä¸‹è½½æ–‡ä»¶çš„æŒç»­æ—¶é—´
  elapsedTime: number;
  // æ›¾ä¸‹è½½æ–‡ä»¶çš„æœ€åä¿®æ”¹æ—¶é—´
  lastModified: number;
  // æ›¾ä¸‹è½½æ–‡ä»¶çš„æœ€åè®¿é—®æ—¶é—´
  lastAccessed: number;
  // æ›¾ä¸‹è½½æ–‡ä»¶çš„å®‰å…¨çŠ¶æ€
  danger: 'safe' | 'accepted' | 'accepted_with_warning' | 'unknown';
  // æ›¾ä¸‹è½½æ–‡ä»¶çš„å¤§å°
  fileSize: number;
  totalBytes: number;
  totalBytesGreater: number;
  totalBytesLess: number;
}
// ä¸‹è½½æŸ¥è¯¢æ¡ä»¶
// query: {} æŸ¥è¯¢æ‰€æœ‰
chrome.downloads.search(
  query: DownloadQuery,
  callback?: (res) => void,
)
```

```js
// background.js
chrome.downloads.search({
  limit: 100,
  orderBy: ['-startTime'],
}, (downloadItems) => {
  console.log('ğŸ„  background: >>>>>>>>>>>>>>>>>> æœç´¢ä¸‹è½½æ–‡ä»¶', Date.now(), downloadItems);
});
```

### open() æ‰“å¼€æ–‡ä»¶
>
> æ‰“å¼€å·²ä¸‹è½½çš„æ–‡ä»¶

```ts
chrome.downloads.open(
  downloadId: number,
  callback?: function,
)
```

### pause() æš‚åœä¸‹è½½
>
> æš‚åœä¸‹è½½

```ts
chrome.downloads.pause(
  downloadId: number,
  callback?: function,
)
```

### resume() æ¢å¤ä¸‹è½½
>
> æ¢å¤ä¸‹è½½

```ts
chrome.downloads.resume(
  downloadId: number,
  callback?: function,
)
```

### cancel() å–æ¶ˆä¸‹è½½
>
> å–æ¶ˆä¸‹è½½

```ts
chrome.downloads.cancel(
  downloadId: number,
  callback?: function,
)
```

### erase() åˆ é™¤ä¸‹è½½
>
> åˆ é™¤ä¸‹è½½

```ts
chrome.downloads.erase(
  query: DownloadQuery,
  callback?: function,
)
```

### removeFile() åˆ é™¤æ–‡ä»¶
>
> åˆ é™¤æ–‡ä»¶

```ts
chrome.downloads.removeFile(
  downloadId: number,
  callback?: function,
)
```

### acceptDanger() æ¥å—å±é™©
>
> æ¥å—å±é™©

```ts
chrome.downloads.acceptDanger(
  downloadId: number,
  callback?: function,
)
```

### show() æ˜¾ç¤ºä¸‹è½½
>
> æ˜¾ç¤ºä¸‹è½½

```ts
chrome.downloads.show(
  downloadId: number,
  callback?: function,
)
```

### getFileIcon() è·å–æ–‡ä»¶å›¾æ ‡
>
> è·å–æ–‡ä»¶å›¾æ ‡

```ts
chrome.downloads.getFileIcon(
  downloadId: number,
  options: {
    size: number,
  },
  callback?: function,
)
```

### showDefaultFolder() æ˜¾ç¤ºé»˜è®¤æ–‡ä»¶å¤¹
>
> æ˜¾ç¤ºé»˜è®¤æ–‡ä»¶å¤¹

```ts
chrome.downloads.showDefaultFolder()
```

## äº‹ä»¶

### onCreated åˆ›å»ºäº‹ä»¶
>
> ä¸‹è½½é¡¹è¢«ä¸‹è½½æ—¶è§¦å‘

```js
// background.js
chrome.downloads.onCreated.addListener((item) => {
  console.log('ğŸ„  background: >>>>>>>>>>>>>>>>>> ç›‘å¬åˆ›å»ºäº‹ä»¶', Date.now(), item);
});
```

### onErased åˆ é™¤äº‹ä»¶
>
> å½“ä¸‹è½½é¡¹è¢«åˆ é™¤æ—¶è§¦å‘

```js
// background.js
chrome.downloads.onErased.addListener((item) => {
  console.log('ğŸ„  background: >>>>>>>>>>>>>>>>>> ç›‘å¬åˆ é™¤äº‹ä»¶', Date.now(), item);
});
```

### onChanged æ›´æ–°äº‹ä»¶
>
> å½“ä¸‹è½½é¡¹çš„çŠ¶æ€å‘ç”Ÿå˜åŒ–æ—¶è§¦å‘ï¼Œä¾‹å¦‚ä¸‹è½½å®Œæˆã€ä¸‹è½½å¤±è´¥ã€ä¸‹è½½æš‚åœã€ä¸‹è½½æ¢å¤ã€ä¸‹è½½å–æ¶ˆç­‰

```js
// background.js
chrome.downloads.onChanged.addListener((item) => {
  //   {
  //     "error": {
  //         "current": "USER_CANCELED"
  //     },
  //     "id": 254,
  //     "state": {
  //         "current": "interrupted",
  //         "previous": "in_progress"
  //     }
  //    }
  console.log('ğŸ„  background: >>>>>>>>>>>>>>>>>> ç›‘å¬æ›´æ–°äº‹ä»¶', Date.now(), item);
});
```

### onDeterminingFilename å–æ–‡ä»¶åäº‹ä»¶
>
> å½“ä¸‹è½½é¡¹çš„æ–‡ä»¶åéœ€è¦ç¡®å®šæ—¶è§¦å‘

```js
// background.js
chrome.downloads.onDeterminingFilename.addListener((item, suggest) => {
  // é»˜è®¤è¦†ç›–åŸæ–‡ä»¶å
  suggest({
    filename: item.filename,
    conflict_action: 'overwrite',
    conflictAction: 'overwrite'
  })
  console.log('ğŸ„  background: >>>>>>>>>>>>>>>>>> ç›‘å¬å–æ–‡ä»¶åäº‹ä»¶', Date.now(), item, suggest);
});
```
