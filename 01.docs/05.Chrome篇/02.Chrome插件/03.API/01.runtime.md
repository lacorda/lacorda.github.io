---
description: runtime
slug: /fc7135e
tags: 
  - runtime
---
# runtime è¿è¡Œæ—¶

[å®˜æ–¹æ–‡æ¡£](https://developer.chrome.com/docs/extensions/reference/runtime/)
> ç”¨äºŽæ£€æµ‹å’Œå“åº”è¿è¡Œæ—¶äº‹ä»¶ï¼Œä¾‹å¦‚åº”ç”¨ç¨‹åºå®‰è£…ã€å¯åŠ¨ã€å…³é—­ã€å¸è½½ç­‰
> è¿”å›žåº”ç”¨çš„è¿è¡Œæ—¶ä¿¡æ¯ï¼Œä¾‹å¦‚åº”ç”¨çš„IDã€ç‰ˆæœ¬ã€æµè§ˆå™¨å’Œæ“ä½œç³»ç»Ÿçš„ä¿¡æ¯

## å±žæ€§

### id åº”ç”¨ID

```js
chrome.runtime.id
```

### lastError é”™è¯¯ä¿¡æ¯

```js
chrome.runtime.lastError
```

## æ–¹æ³• - èŽ·å–åº”ç”¨ä¿¡æ¯

### getManifest() èŽ·å–manifest.json

```js
chrome.runtime.getManifest()
```

### getURL() èŽ·å–èµ„æºè·¯å¾„

```js
chrome.runtime.getURL(path: string)
```

### getPlatformInfo() èŽ·å–å¹³å°ä¿¡æ¯

```js
chrome.runtime.getPlatformInfo()
```

### getPackageDirectoryEntry() èŽ·å–åŒ…ç›®å½•

```js
chrome.runtime.getPackageDirectoryEntry()
```

### getBackgroundPage() èŽ·å–åŽå°é¡µé¢
>
> è¿”å›žåŽå°é¡µé¢çš„windowå¯¹è±¡

```js
chrome.runtime.getBackgroundPage()
```

### getContexts() èŽ·å–åº”ç”¨æ‰€æœ‰é¡µé¢ä¿¡æ¯

```ts
type ContextType = "TAB" | "POPUP" | "BACKGROUND" | "OFFSCREEN_DOCUMENT" | "SIDE_PANEL";

type ContextFilter = {
  contextIds?: string[];
  contextTypes?: ContextType[];
  documentIds?: string[];
  documentOrigins?: string[];
  documentUrls?: string[];
  frameIds?: number[];
  incognito?: boolean;
  tabIds?: number[];
  windowIds?: number[];
}

chrome.runtime.getContexts(
  filter: ContextFilter,
  callback?: function,
)
```

## æ–¹æ³• - æ“ä½œåº”ç”¨

### reload() é‡æ–°åŠ è½½åº”ç”¨

```js
chrome.runtime.reload()
```

### restart() é‡å¯åº”ç”¨

```js
chrome.runtime.restart()
```

### restartAfterDelay() å»¶è¿Ÿé‡å¯åº”ç”¨

```js
chrome.runtime.restartAfterDelay(
  seconds: number,
  callback?: function,
)
```

### openOptionsPage() æ‰“å¼€è®¾ç½®é¡µé¢

```js
chrome.runtime.openOptionsPage()
```

### requestUpdateCheck() æ£€æŸ¥æ›´æ–°

```js
chrome.runtime.requestUpdateCheck(
  callback?: function,
)
```

### setUninstallURL() è®¾ç½®å¸è½½URL

```js
chrome.runtime.setUninstallURL(
  url: string,
  callback?: function,
)
```

## æ–¹æ³• - æ¶ˆæ¯ä¼ é€’

### sendMessage() æ’ä»¶å†…å‘é€æ¶ˆæ¯

```ts
chrome.runtime.sendMessage(
  extensionId?: string,
  message: any,
  options?: MessageOptions,
  callback?: (response: any) => void,
)
```

### sendNativeMessage() æ’ä»¶å¤–å‘é€æ¶ˆæ¯

```ts
chrome.runtime.sendNativeMessage(
  application: string,
  message: any,
  callback?: (response: any) => void,
)
```

### connect() æ’ä»¶å†…é•¿è¿žæŽ¥

```ts
chrome.runtime.connect(
  extensionId?: string,
  connectInfo?: ConnectInfo,
)
```

### connectNative() æ’ä»¶å¤–é•¿è¿žæŽ¥

```ts
chrome.runtime.connectNative(
  application: string,
)
```

## äº‹ä»¶ - åº”ç”¨ç”Ÿå‘½å‘¨æœŸ

### onStartup åº”ç”¨å¯åŠ¨äº‹ä»¶

```js
// background.js
chrome.runtime.onStartup.addListener(() => {
  console.log('ðŸ„  background: >>>>>>>>>>>>>>>>>> åº”ç”¨å¯åŠ¨äº‹ä»¶', Date.now());
});
```

### onInstalled åº”ç”¨å®‰è£…äº‹ä»¶

```ts
type OnInstalledReason = 'install' | 'update' | 'chrome_update' | 'shared_module_update';
type OnInstalledDetails = {
  reason: OnInstalledReason;
  id?: string;
}
chrome.runtime.onInstalled.addListener(((details: OnInstalledDetails)) => {
  console.log('ðŸ„  background: >>>>>>>>>>>>>>>>>> åº”ç”¨å®‰è£…äº‹ä»¶', Date.now());
});
```

### onSuspend åº”ç”¨æŒ‚èµ·äº‹ä»¶(å¸è½½ä¹‹å‰)

```js
// background.js
chrome.runtime.onSuspend.addListener(() => {
  console.log('ðŸ„  background: >>>>>>>>>>>>>>>>>> åº”ç”¨æŒ‚èµ·äº‹ä»¶', Date.now());
});
```

### onSuspendCanceled åº”ç”¨å–æ¶ˆæŒ‚èµ·äº‹ä»¶

```js
// background.js
chrome.runtime.onSuspendCanceled.addListener(() => {
  console.log('ðŸ„  background: >>>>>>>>>>>>>>>>>> åº”ç”¨å–æ¶ˆæŒ‚èµ·äº‹ä»¶', Date.now());
});
```

### onRestartRequired åº”ç”¨é‡å¯äº‹ä»¶

```js
// background.js
chrome.runtime.onRestartRequired.addListener(() => {
  console.log('ðŸ„  background: >>>>>>>>>>>>>>>>>> åº”ç”¨é‡å¯äº‹ä»¶', Date.now());
});
```

## äº‹ä»¶ - æ¶ˆæ¯ç›‘å¬

### onMessage åº”ç”¨å†…æ¶ˆæ¯äº‹ä»¶

```ts
type MessageSender = {
  id?: string;
  url?: string;
  tlsChannelId?: string;
  tab?: chrome.Tabs.Tab;
  documentId?: string;
  frameId?: number;
  nativeApplication?: string;
  origin?: string;
}
chrome.runtime.onMessage.addListener(
  message: any,
  sender: MessageSender,
  sendResponse: function
) => boolean | undefined;
```

### onMessageExternal æ¥è‡ªç½‘é¡µ/å…¶ä»–æ’ä»¶çš„æ¶ˆæ¯äº‹ä»¶

```js
// background.js
chrome.runtime.onMessageExternal.addListener(() => {
  console.log('ðŸ„  background: >>>>>>>>>>>>>>>>>> åº”ç”¨å¤–éƒ¨æ¶ˆæ¯äº‹ä»¶', Date.now());
});
```

### onConnect åº”ç”¨å†…é•¿è¿žæŽ¥äº‹ä»¶

```ts
type Port = {
  name: string;
  onDisconnect: {
    addListener: (callback: (port: Port) => void) => void;
  };
}
chrome.runtime.onConnect.addListener((port: Port) => {
  console.log('ðŸ„  background: >>>>>>>>>>>>>>>>>> åº”ç”¨è¿žæŽ¥äº‹ä»¶', Date.now());
});
```

### onConnectExternal æ¥è‡ªç½‘é¡µ/å…¶ä»–æ’ä»¶çš„è¿žæŽ¥äº‹ä»¶

```js
// background.js
chrome.runtime.onConnectExternal.addListener(() => {
  console.log('ðŸ„  background: >>>>>>>>>>>>>>>>>> åº”ç”¨å¤–éƒ¨è¿žæŽ¥äº‹ä»¶', Date.now());
});
```
