---
description: jsx
slug: /71318bd
tags: 
  - jsx
---

## å‰è¨€

#### æœ¬ç« å°†å­¦ä¹ åˆ°çš„å†…å®¹
+ äº†è§£`jsx`çš„æ¸²æŸ“è¿‡ç¨‹
+ `React Fiber`ä¸`èŠ‚ç‚¹`ä¸€ä¸€å¯¹åº”çš„å…³ç³»
+ é€šè¿‡`api`ä¿®æ”¹`children`ï¼Œä¿®æ”¹`react`æ¸²æŸ“å†…å®¹


:::tip æœªæ·±å…¥å¾…ç ”ç©¶å†…å®¹

- `Fiber`çš„è®¾è®¡æ€è·¯
  - Fiber å¯ä»¥ç†è§£ä¸ºæ˜¯ä¸€ä¸ªæ‰§è¡Œå•å…ƒï¼Œä¹Ÿå¯ä»¥ç†è§£ä¸ºæ˜¯ä¸€ç§æ•°æ®ç»“æ„
- Reactæ’æ§½ç»„ä»¶

:::

<details>
<summary>
`Vue` æ˜¯æ²¡æœ‰ `Fiber` çš„ï¼Œä¸ºä»€ä¹ˆå‘¢ï¼ŸåŸå› æ˜¯äºŒè€…çš„ä¼˜åŒ–æ€è·¯ä¸ä¸€æ ·
</summary>
<ul>
<li>
`Vue` æ˜¯åŸºäº `template` å’Œ `watcher` çš„ç»„ä»¶çº§æ›´æ–°ï¼ŒæŠŠæ¯ä¸ªæ›´æ–°ä»»åŠ¡åˆ†å‰²å¾—è¶³å¤Ÿå°ï¼Œä¸éœ€è¦ä½¿ç”¨åˆ° `Fiber` æ¶æ„ï¼Œå°†ä»»åŠ¡è¿›è¡Œæ›´ç»†ç²’åº¦çš„æ‹†åˆ†
</li>
<li>
`React` æ˜¯ä¸ç®¡åœ¨å“ªé‡Œè°ƒç”¨ `setState`ï¼Œéƒ½æ˜¯ä»æ ¹èŠ‚ç‚¹å¼€å§‹æ›´æ–°çš„ï¼Œæ›´æ–°ä»»åŠ¡è¿˜æ˜¯å¾ˆå¤§ï¼Œéœ€è¦ä½¿ç”¨åˆ° `Fiber` å°† ***å¤§ä»»åŠ¡åˆ†å‰²ä¸ºå¤šä¸ªå°ä»»åŠ¡***ï¼Œå¯ä»¥ä¸­æ–­å’Œæ¢å¤ï¼Œ***ä¸é˜»å¡ä¸»è¿›ç¨‹æ‰§è¡Œé«˜ä¼˜å…ˆçº§çš„ä»»åŠ¡***
</li>
</ul>
</details>

JSX å…ƒç´ èŠ‚ç‚¹ä¼šè¢«ç¼–è¯‘æˆ `React.createElement` 


## jsxçš„æ¸²æŸ“è¿‡ç¨‹
![](@site/static/docs/05.Reactç¯‡/jsx03.png)


:::tip React ä¸­ï¼Œä¸ºä»€ä¹ˆå†™ jsx çš„æ–‡ä»¶è¦é»˜è®¤å¼•å…¥ React?

å› ä¸º jsx åœ¨è¢« babel ç¼–è¯‘åï¼Œå†™çš„ jsx ä¼šå˜æˆä¸Šè¿° React.createElement å½¢å¼ï¼Œæ‰€ä»¥éœ€è¦å¼•å…¥ Reactï¼Œé˜²æ­¢æ‰¾ä¸åˆ° React å¼•èµ·æŠ¥é”™

:::


### æ —å­

```jsx
import React from 'react'


const toLearn = ['react', 'vue', 'webpack', 'nodejs']

const TextComponent = () => <div> hello , i am function component </div>

class Index extends React.Component {
  status = false /* çŠ¶æ€ */
  renderFoot = () => <div> i am foot</div>
  return (
    <div className="container" style={marginTop: '10px'}>
      {/* element å…ƒç´ ç±»å‹ */}
      <div>hello,world</div>
      {/* fragment ç±»å‹ */}
      <React.Fragment>
          <div> ğŸ‘½ğŸ‘½ </div>
      </React.Fragment>
      {/* text æ–‡æœ¬ç±»å‹ */}
      my name is alien
      {/* æ•°ç»„èŠ‚ç‚¹ç±»å‹ */}
      {toLearn.map(item => <div key={item} >let us learn {item} </div>)}
      {/* ç»„ä»¶ç±»å‹ */}
      <TextComponent />
      {/* ä¸‰å…ƒè¿ç®— */}
      {this.status ? <TextComponent /> : <div>ä¸‰å…ƒè¿ç®—</div>}
      {/* å‡½æ•°æ‰§è¡Œ */}
      {this.renderFoot()}
      <button onClick={() => console.log(this.render())} >æ‰“å°renderåçš„å†…å®¹</button>
    </div>
  )
}
```


### React.createElementå¤„ç†

| `jsx`å…ƒç´ ç±»å‹     | `react.createElement` è½¬æ¢å                      | `type` å±æ€§                   |
| ----------------- | ------------------------------------------------- | ----------------------------- |
| `element`å…ƒç´ ç±»å‹ | `react element`ç±»å‹                               | æ ‡ç­¾å­—ç¬¦ä¸²ï¼Œä¾‹å¦‚ `div`        |
| `fragment`ç±»å‹    | `react element`ç±»å‹                               | `symbol` `react.fragment`ç±»å‹ |
| æ–‡æœ¬ç±»å‹          | ç›´æ¥å­—ç¬¦ä¸²                                        | æ—                             |
| æ•°ç»„ç±»å‹          | è¿”å›æ•°ç»„ç»“æ„ï¼Œé‡Œé¢å…ƒç´ è¢«`react.createElement`è½¬æ¢ | æ—                             |
| ç»„ä»¶ç±»å‹          | `react element`ç±»å‹                               | ç»„ä»¶ç±»æˆ–è€…ç»„ä»¶å‡½æ•°æœ¬èº«        |
| ä¸‰å…ƒè¿ç®— / è¡¨è¾¾å¼ | å…ˆæ‰§è¡Œä¸‰å…ƒè¿ç®—ï¼Œç„¶åæŒ‰ç…§ä¸Šè¿°è§„åˆ™å¤„ç†              | çœ‹ä¸‰å…ƒè¿ç®—è¿”å›ç»“æœ            |
| å‡½æ•°æ‰§è¡Œ          | å…ˆæ‰§è¡Œå‡½æ•°ï¼Œç„¶åæŒ‰ç…§ä¸Šè¿°è§„åˆ™å¤„ç†                  | çœ‹å‡½æ•°æ‰§è¡Œè¿”å›ç»“æœ            |


![](@site/static/docs/05.Reactç¯‡/jsx01.png)


### element å¯¹è±¡å’Œ fiber ç±»å‹çš„å¯¹åº”å…³ç³»

React element å¯¹è±¡çš„æ¯ä¸€ä¸ªå­èŠ‚ç‚¹éƒ½ä¼šå½¢æˆä¸€ä¸ªä¸ä¹‹å¯¹åº”çš„ fiber å¯¹è±¡ï¼Œç„¶åé€šè¿‡ siblingã€returnã€child å°†æ¯ä¸€ä¸ª fiber å¯¹è±¡è”ç³»èµ·æ¥ã€‚

```js
export const FunctionComponent = 0;       // å‡½æ•°ç»„ä»¶
export const ClassComponent = 1;          // ç±»ç»„ä»¶
export const IndeterminateComponent = 2;  // åˆå§‹åŒ–çš„æ—¶å€™ä¸çŸ¥é“æ˜¯å‡½æ•°ç»„ä»¶è¿˜æ˜¯ç±»ç»„ä»¶ 
export const HostRoot = 3;                // Root Fiber å¯ä»¥ç†è§£ä¸ºæ ¹å…ƒç´  ï¼Œ é€šè¿‡reactDom.render()äº§ç”Ÿçš„æ ¹å…ƒç´ 
export const HostPortal = 4;              // å¯¹åº”  ReactDOM.createPortal äº§ç”Ÿçš„ Portal 
export const HostComponent = 5;           // dom å…ƒç´  æ¯”å¦‚ <div>
export const HostText = 6;                // æ–‡æœ¬èŠ‚ç‚¹
export const Fragment = 7;                // å¯¹åº” <React.Fragment> 
export const Mode = 8;                    // å¯¹åº” <React.StrictMode>   
export const ContextConsumer = 9;         // å¯¹åº” <Context.Consumer>
export const ContextProvider = 10;        // å¯¹åº” <Context.Provider>
export const ForwardRef = 11;             // å¯¹åº” React.ForwardRef
export const Profiler = 12;               // å¯¹åº” <Profiler/ >
export const SuspenseComponent = 13;      // å¯¹åº” <Suspense>
export const MemoComponent = 14;          // å¯¹åº” React.memo è¿”å›çš„ç»„ä»¶
```

![](@site/static/docs/05.Reactç¯‡/jsx02.png)

:::tip fiber å¯¹åº”å…³ç³»

+ childï¼š ä¸€ä¸ªç”±çˆ¶çº§ fiber æŒ‡å‘å­çº§ fiber çš„æŒ‡é’ˆã€‚
+ returnï¼šä¸€ä¸ªå­çº§ fiber æŒ‡å‘çˆ¶çº§ fiber çš„æŒ‡é’ˆã€‚
+ sibling: ä¸€ä¸ª fiber æŒ‡å‘ä¸‹ä¸€ä¸ªå…„å¼Ÿ fiber çš„æŒ‡é’ˆã€‚

:::

:::tip

jsx ä¸­å†™çš„ map æ•°ç»„ç»“æ„çš„å­èŠ‚ç‚¹ï¼Œå¤–å±‚ä¼šè¢«åŠ ä¸Š fragment ï¼›
map è¿”å›æ•°ç»„ç»“æ„ï¼Œä½œä¸º fragment çš„å­èŠ‚ç‚¹ã€‚


:::


### babelçš„jsxè§£ææµç¨‹

#### ä½¿ç”¨`@babel/preset-react`:


```js
function Index(){
    return <div>
        <h1>hello,world</h1>
        <span>let us learn React</span>
    </div>
}
```

#### ä½¿ç”¨`automatic`æ¨¡å¼
```js title=.babelrc
"presets": [    
  ["@babel/preset-react",{
    "runtime": "automatic"
  }]     
]
```

ç¼–è¯‘åï¼š
```js
import { jsx as _jsx } from "react/jsx-runtime";
import { jsxs as _jsxs } from "react/jsx-runtime";
function Index() {
  return  _jsxs("div", {
            children: [
                _jsx("h1", {
                   children: "hello,world"
                }),
                _jsx("span", {
                    children:"let us learn React" ,
                }),
            ],
        });
}
```

#### ä½¿ç”¨`classic`ç»å…¸æ¨¡å¼

ç¼–è¯‘åï¼š
```js
import React from 'react'
function Index(){
  return  React.createElement(
      "div",
      null,
      React.createElement("h1", null,"hello,world"),
      React.createElement("span", null, "let us learn React")
  );
}
```

:::tip

classicæ¨¡å¼ä¸‹éœ€è¦å¼•å…¥ React ï¼Œä¸ç„¶å°±ä¼šæŠ¥é”™

:::


### babel apiæ¨¡æ‹Ÿå®ç°
```js
const fs = require('fs')
const babel = require("@babel/core")

/* ç¬¬ä¸€æ­¥ï¼šæ¨¡æ‹Ÿè¯»å–æ–‡ä»¶å†…å®¹ã€‚ */
fs.readFile('./element.js',(e,data)=>{ 
    const code = data.toString('utf-8')
    /* ç¬¬äºŒæ­¥ï¼šè½¬æ¢ jsx æ–‡ä»¶ */
    const result = babel.transformSync(code, {
        plugins: ["@babel/plugin-transform-react-jsx"],
    });
    /* ç¬¬ä¸‰æ­¥ï¼šæ¨¡æ‹Ÿé‡æ–°å†™å…¥å†…å®¹ã€‚ */
    fs.writeFile('./element.js',result.code,function(){})
})
```

```js title=element.jsç¼–è¯‘å‰
import React from 'react'

function TestComponent(){
    return <p> hello,React </p>
}
function Index(){
    return <div>
        <span>æ¨¡æ‹Ÿ babel å¤„ç† jsx æµç¨‹ã€‚</span>
        <TestComponent />
    </div>
}
export default Index

```

```js title=element.jsç¼–è¯‘å
import React from 'react';

function TestComponent() {
  return /*#__PURE__*/React.createElement("p", null, " hello,React ");
}

function Index() {
  return /*#__PURE__*/React.createElement("div", null, /*#__PURE__*/React.createElement("span", null, "\u6A21\u62DF babel \u5904\u7406 jsx \u6D41\u7A0B\u3002"), /*#__PURE__*/React.createElement(TestComponent, null));
}
export default Index;
```

## ä½¿ç”¨React APIæ§åˆ¶children

### React.Children.toArray
æ·±å±‚æ‰å¹³åŒ–`children`ï¼Œå¹¶ä¸”è§„åˆ™åŒ–`React.element`(æ·»åŠ `key`)

### React.isValidElement
æ£€æµ‹`React.element`èŠ‚ç‚¹ï¼Œæ–‡æœ¬èŠ‚ç‚¹é`React.element`èŠ‚ç‚¹


### React.createElement
åˆ›å»º`React.element`èŠ‚ç‚¹

```js title=è¯­æ³•
React.createElement(
  type,
  [props],
  [...children]
)
```


### React.cloneElement
å…‹éš†åŸæ¥çš„å…ƒç´ ï¼Œè¿”å›ä¸€ä¸ªæ–°çš„ React å…ƒç´ 

```js title=è¯­æ³•
React.cloneElement(
  element,
  [props], // ç¬¬äºŒä¸ªå‚æ•°ï¼šä¿ç•™åŸå§‹å…ƒç´ çš„ propsï¼ŒåŒæ—¶å¯ä»¥æ·»åŠ æ–°çš„ propsï¼Œä¸¤è€…è¿›è¡Œæµ…åˆå¹¶ï¼›key å’Œ ref ä¼šè¢«ä¿ç•™ï¼Œå› ä¸ºå®ƒä»¬æœ¬èº«ä¹Ÿæ˜¯ props ï¼Œæ‰€ä»¥ä¹Ÿå¯ä»¥ä¿®æ”¹
  [...children] // å®šä¹‰ä»»æ„å¤šçš„å­å…ƒç´ ï¼Œå¦‚æœå®šä¹‰äº†æ–°çš„ children ï¼Œä¼šæ›¿æ¢åŸæ¥çš„ children
)