
[官方文档](https://developer.chrome.com/docs/extensions/reference/api)



## runtime 运行时
[官方文档](https://developer.chrome.com/docs/extensions/reference/runtime/)
> 用于检测和响应运行时事件，例如应用程序安装、启动、关闭、卸载等
> 返回应用的运行时信息，例如应用的ID、版本、浏览器和操作系统的信息


### 属性

#### id 应用ID

```js
chrome.runtime.id
```

#### lastError 错误信息

```js
chrome.runtime.lastError
```

### 方法 - 获取应用信息

#### getManifest() 获取manifest.json

```js
chrome.runtime.getManifest()
```

#### getURL() 获取资源路径

```js
chrome.runtime.getURL(path: string)
```

#### getPlatformInfo() 获取平台信息

```js
chrome.runtime.getPlatformInfo()
```

#### getPackageDirectoryEntry() 获取包目录

```js
chrome.runtime.getPackageDirectoryEntry()
```

#### getBackgroundPage() 获取后台页面
> 返回后台页面的window对象

```js
chrome.runtime.getBackgroundPage()
```

#### getContexts() 获取应用所有页面信息

```ts
type ContextType = "TAB" | "POPUP" | "BACKGROUND" | "OFFSCREEN_DOCUMENT" | "SIDE_PANEL";

type ContextFilter = {
  contextIds?: string[];
  contextTypes?: ContextType[];
  documentIds?: string[];
  documentOrigins?: string[];
  documentUrls?: string[];
  frameIds?: number[];
  incognito?: boolean;
  tabIds?: number[];
  windowIds?: number[];
}

chrome.runtime.getContexts(
  filter: ContextFilter,
  callback?: function,
)
```

### 方法 - 操作应用

#### reload() 重新加载应用

```js
chrome.runtime.reload()
```

#### restart() 重启应用

```js
chrome.runtime.restart()
```

#### restartAfterDelay() 延迟重启应用

```js
chrome.runtime.restartAfterDelay(
  seconds: number,
  callback?: function,
)
```


#### openOptionsPage() 打开设置页面

```js
chrome.runtime.openOptionsPage()
```

#### requestUpdateCheck() 检查更新

```js
chrome.runtime.requestUpdateCheck(
  callback?: function,
)
```

#### setUninstallURL() 设置卸载URL

```js
chrome.runtime.setUninstallURL(
  url: string,
  callback?: function,
)
```


### 方法 - 消息传递

#### sendMessage() 插件内发送消息

```ts
chrome.runtime.sendMessage(
  extensionId?: string,
  message: any,
  options?: MessageOptions,
  callback?: (response: any) => void,
)
```

#### sendNativeMessage() 插件外发送消息

```ts
chrome.runtime.sendNativeMessage(
  application: string,
  message: any,
  callback?: (response: any) => void,
)
```

#### connect() 插件内长连接

```ts
chrome.runtime.connect(
  extensionId?: string,
  connectInfo?: ConnectInfo,
)
```

#### connectNative() 插件外长连接

```ts
chrome.runtime.connectNative(
  application: string,
)
```


### 事件 - 应用生命周期

#### onStartup 应用启动事件

```js
// background.js
chrome.runtime.onStartup.addListener(() => {
  console.log('🍄  background: >>>>>>>>>>>>>>>>>> 应用启动事件', Date.now());
});
```

#### onInstalled 应用安装事件

```js
// background.js
chrome.runtime.onInstalled.addListener(() => {
  console.log('🍄  background: >>>>>>>>>>>>>>>>>> 应用安装事件', Date.now());
});
```

#### onSuspend 应用挂起事件(卸载之前)

```js
// background.js
chrome.runtime.onSuspend.addListener(() => {
  console.log('🍄  background: >>>>>>>>>>>>>>>>>> 应用挂起事件', Date.now());
});
```

#### onSuspendCanceled 应用取消挂起事件

```js
// background.js
chrome.runtime.onSuspendCanceled.addListener(() => {
  console.log('🍄  background: >>>>>>>>>>>>>>>>>> 应用取消挂起事件', Date.now());
});
```


#### onRestartRequired 应用重启事件

```js
// background.js
chrome.runtime.onRestartRequired.addListener(() => {
  console.log('🍄  background: >>>>>>>>>>>>>>>>>> 应用重启事件', Date.now());
});
```

### 事件 - 消息监听

#### onMessage 应用内消息事件

```js
// background.js
chrome.runtime.onMessage.addListener(() => {
  console.log('🍄  background: >>>>>>>>>>>>>>>>>> 应用消息事件', Date.now());
});
```

#### onMessageExternal 来自网页/其他插件的消息事件

```js
// background.js
chrome.runtime.onMessageExternal.addListener(() => {
  console.log('🍄  background: >>>>>>>>>>>>>>>>>> 应用外部消息事件', Date.now());
});
```

#### onConnect 应用内长连接事件

```js
// background.js
chrome.runtime.onConnect.addListener(() => {
  console.log('🍄  background: >>>>>>>>>>>>>>>>>> 应用连接事件', Date.now());
});
```

#### onConnectExternal 来自网页/其他插件的连接事件

```js
// background.js
chrome.runtime.onConnectExternal.addListener(() => {
  console.log('🍄  background: >>>>>>>>>>>>>>>>>> 应用外部连接事件', Date.now());
});
```


## chrome.storage 存储
[官方文档](https://developer.chrome.com/docs/extensions/reference/storage/)

> 用于存储、检索和跟踪应用的用户数据

### 权限设置

```json
"permissions": [
  "storage"
],
```

### 属性

#### sync 同步存储

```js
chrome.storage.sync
```

#### local 本地存储

```js
chrome.storage.local
```

#### managed 管理存储

```js
chrome.storage.managed
```

#### sync 同步存储

```js
chrome.storage.sync
```

### 事件

#### onChanged 存储变化事件

```ts
chrome.storage.onChanged.addListener(
  callback: (changes: object,areaName:string) => void
)
```

## chrome.sidePanel 侧边栏
[官方文档](https://developer.chrome.com/docs/extensions/reference/sidePanel/)

> 用于创建、管理和控制侧边栏

![侧边栏](@site/static/docs/13.Chrome篇/chrome-sidePanel.png)


### 权限设置

```json
"permissions": [
  "sidePanel"
],
```

### 方法

#### getOptions() 获取侧边栏选项

```ts
type GetPanelOptions = {
  tabId?: number;
}

type PanelOptions = {
  enabled?: boolean;
  path?: string;
  tabId?: number;
}

chrome.sidePanel.getOptions(
  options: GetPanelOptions,
  callback?: (options: PanelOptions)=>void,
)
```


#### getPanelBehavior() 获取侧边栏行为

```ts
type PanelBehavior = {
  enabled?: boolean;
  path?: string;
  tabId?: number;
}

chrome.sidePanel.getPanelBehavior(
  callback?: (options: PanelBehavior)=>void,
)
```

#### open() 打开侧边栏

```ts
type OpenOptions = {
  // tabId 和 windowId 必须指定一个
  tabId?: number;
  windowId?: number;
}

chrome.sidePanel.open(
  options: OpenOptions,
  callback?: () => void,
)
```

#### setOptions() 设置侧边栏选项

```ts
type PanelOptions = {
  enabled?: boolean;
  path?: string;
  tabId?: number;
}

chrome.sidePanel.setOptions(
  options: PanelOptions,
  callback?: () => void,
)
```


#### setPanelBehavior() 设置侧边栏行为

```ts
type PanelBehavior = {
  enabled?: boolean;
  path?: string;
  tabId?: number;
}

chrome.sidePanel.setPanelBehavior(
  behavior: PanelBehavior,
  callback?: () => void,
)
```

## chrome.tabCapture 标签媒体流
[官方文档](https://developer.chrome.com/docs/extensions/reference/tabCapture/)

> 用于捕获标签的媒体流

### 权限设置

```json
"permissions": [
  "tabCapture"
],
```

### 方法

#### capture() 捕获标签媒体流
> 捕获当前活动选项卡的可见区域的媒体流

```ts
type MediaStreamConstraint = {
  mandatory: object;
  optional?: object;
}

type CaptureOptions = {
  audio?: boolean;
  audioConstraints?: MediaStreamConstraint;
  video?: boolean;
  videoConstraints?: MediaStreamConstraint;
}

chrome.tabCapture.capture(
  options: CaptureOptions,
  callback: (stream: LocalMediaStream) => void,
)
```

#### getCapturedTabs() 获取捕获的标签
> 已请求捕获或正在捕获的选项卡列表

```ts
type TabCaptureState = 'pending' | 'active' | 'stopped' | 'error';

type CaptureInfo = {
  fullscreen: boolean;
  status: TabCaptureState;
  tabId: number;
}

chrome.tabCapture.getCapturedTabs(
  callback?: (result: CaptureInfo[]) => void,
)
```

#### getMediaStreamId() 获取媒体流ID
> 获取当前媒体流的ID

```ts
type GetMediaStreamOptions = {
  // 选项卡 ID
  consumerTabId?: number;
  targetTabId?: number;
}

chrome.tabCapture.getMediaStreamId(
  options?: GetMediaStreamOptions,
  callback?: (streamId: string) => void,
)

// 获取到的媒体流ID，再通过 navigator.mediaDevices.getUserMedia({audio: {streamId: streamId}}) 获取媒体流
navigator.mediaDevices.getUserMedia({
  audio: {
    mandatory: {
      chromeMediaSource: "tab",
      chromeMediaSourceId: id,
    },
  },
  video: {
    mandatory: {
      chromeMediaSource: "tab",
      chromeMediaSourceId: id,
    },
  },
});
```

### 事件

#### onStatusChanged 状态变化事件
> 当捕获的标签的状态发生变化时触发

```ts
type CaptureInfo = {
  fullscreen: boolean;
  status: TabCaptureState;
  tabId: number;
}

// background.js
chrome.tabCapture.onStatusChanged.addListener((info: CaptureInfo) => {
  console.log('🍄  background: >>>>>>>>>>>>>>>>>> 状态变化事件', Date.now(), info);
});
```

## chrome.scripting 脚本
[官方文档](https://developer.chrome.com/docs/extensions/reference/scripting/)
> 动态管理网页内容，例如注入脚本、样式表、执行脚本等


### 权限设置

```json
"permissions": [
  "scripting"
],
```


### getRegisteredContentScripts() 获取已注册的内容脚本

```ts
type ContentScriptFilter = {
  ids?: string[];
}

type RunAt = 'document_start' | 'document_end' | 'document_idle';

type ExecutionWorld = 'isolated_world' | 'shared_world';

type RegisteredContentScript = {
  allFrames?: boolean;
  css?: string[];
  excludeMatches?: string[];
  id: string;
  js?: string[];
  matchOriginAsFallback?: boolean;
  matches?: string[];
  persistAcrossSessions?: boolean;
  runAt?: RunAt;
  world?: ExecutionWorld;
}

chrome.scripting.getRegisteredContentScripts(
  filter?: ContentScriptFilter
  callback?: (scripts: RegisteredContentScript[]) => void,
)
```

### registerContentScripts() 注册内容脚本

```ts
type RegisteredContentScript = {
  allFrames?: boolean;
  css?: string[];
  excludeMatches?: string[];
  id: string;
  js?: string[];
  matchOriginAsFallback?: boolean;
  matches?: string[];
  persistAcrossSessions?: boolean;
  runAt?: RunAt;
  world?: ExecutionWorld;
}

chrome.scripting.registerContentScripts(
  scripts: RegisteredContentScript[],
  callback?: () => void,
)
```

### executeScript() 注入脚本

```ts
type InjectionTarget = {
  // 要注入到的选项卡的 ID。
  tabId: number;
  // 要注入到的特定帧的 ID。
  frameIds?: number[];
  // 脚本是否应注入到选项卡内的所有帧中。默认值为 false。如果 frameIds 指定，则不能为真。
  allFrames?: boolean;
  // 要注入到的特定 documentId 的 ID。如果 frameIds 已设置，则不得设置此项。
  documentIds?: string[];
}

type ScriptInjection = {
  // 要引入所提供函数的参数。仅当指定了参数 func 时，这才有效。这些参数必须是 JSON 可序列化的。
  args?: any[];
  // 要注入的 JS 或 CSS 文件的路径，相对于扩展的根目录
  files?: string[];
  // 立即注入
  injectImmediately?: boolean;
  target: InjectionTarget;
  // 隔离环境 / 与宿主页面的 JavaScript 共享的执行环境
  world?: "ISOLATED" | "MAIN";
  func?: () => void;
}

chrome.scripting.executeScript(
  injection: ScriptInjection,
  callback?: () => void,
)
```

### insertCSS() 注入样式表

```ts
type InjectionTarget = {
  // 要注入到的选项卡的 ID。
  tabId: number;
  // 要注入到的特定帧的 ID。
  frameIds?: number[];
  // 脚本是否应注入到选项卡内的所有帧中。默认值为 false。如果 frameIds 指定，则不能为真。
  allFrames?: boolean;
  // 要注入到的特定 documentId 的 ID。如果 frameIds 已设置，则不得设置此项。
  documentIds?: string[];
}

type CSSInjection = {
  // 必须指定 files 和 css 之一 
  css?: string;
  // 必须指定 files 和 css 之一
  files?: string[];
  origin?: "USER" | "AUTHOR";
  target: InjectionTarget;
}

chrome.scripting.insertCSS(
  injection: CSSInjection,
  callback?: () => void,
)
```

### updateContentScript() 更新内容脚本

```ts
type RegisteredContentScript = {
  allFrames?: boolean;
  css?: string[];
  excludeMatches?: string[];
  id: string;
  js?: string[];
  matchOriginAsFallback?: boolean;
  matches?: string[];
  persistAcrossSessions?: boolean;
  runAt?: RunAt;
  world?: ExecutionWorld;
}

chrome.scripting.updateContentScript(
  scripts: RegisteredContentScript[],
  callback?: () => void,
)
```

### unregisterContentScripts() 注销内容脚本

```ts
chrome.scripting.unregisterContentScripts(
  filter?: ContentScriptFilter,
  callback?: function,
)
```

### removeCSS() 移除样式表

```ts
chrome.scripting.removeCSS(
  injection: CSSInjection,
  callback?: function,
)
```



## chrome.action 工具栏
> 控制工具栏中扩展程序的图标，`manifest.json`必须配置`action`字段

### icon图标

```json
// manifest.json
{
  "action": {
    "default_icon": "icon-48.png"
  }
}
```

```js
// background.js
const canvas = new OffscreenCanvas(16, 16);
const context = canvas.getContext('2d');
context.clearRect(0, 0, 16, 16);
context.fillStyle = '#00FF00';  // Green
context.fillRect(0, 0, 16, 16);
const imageData = context.getImageData(0, 0, 16, 16);

chrome.action.setIcon({
  // imageData: 图像数据
  imageData,
  // path: 相对图像路径
  path: {
    "48": "icon-48.png",
    "128": "icon-128.png"
  }
}, () => { 
  /* callback */ 
});
```

### Tooltip(Title)提示
> 当用户将鼠标指针悬停在工具栏中的扩展图标上时，将显示工具提示或标题

```json
// manifest.json
{
  "action": {
    "default_title": "Click here!"
  }
}
```

```js 
// background.js
chrome.action.setTitle({
  title: 'Hello World!'
}, () => {  /* ... */ });
```

### Badge徽章
> 在工具栏图标上显示徽章，徽章是一个小的文本标签，用于显示有关扩展程序的信息，例如未读消息数

:::tip
在哪个部分设置Badge?
:::

```js
// 设置徽章背景颜色
chrome.action.setBadgeBackgroundColor({
  color: '#FF0000'
}, () => {  /* ... */ });

// 设置徽章文本
chrome.action.setBadgeText({
  text: 'Hello World!',
  // 每个选项卡的扩展操作可以具有不同的状态
  // 如果省略该 tabId 属性，则将该设置视为全局设置
  tabId: getTabId(),
}, () => {  /* ... */ });

// 设置徽章文本颜色
chrome.action.setBadgeTextColor({
  color: '#ffffff'
}, () => {  /* ... */ });
```

### Popup弹窗/onClicked事件
> 点击工具栏图标时，显示弹窗，回调方法参数为当前tab信息

```json
// manifest.json
{
  "action": {
    "default_popup": "popup.html"
  }
}
```

```js
// background.js
// 监听popup图标点击事件
chrome.action.onClicked.addListener((tab) => {
  // 打开popup弹窗
  chrome.action.openPopup();

  // 将内容脚本注入到当前页面中
  chrome.scripting.executeScript({
    target: {tabId: tab.id},
    files: ['content.js']
  });

  // 打开新页面
  chrome.tabs.create({ url: 'index.html' });
});
```

### disabled()/enable()方法
> 禁用（不可点击） / 启用

```js
// 禁用
chrome.action.disable(tabId, () => {  /* ... */ });

// 启用
chrome.action.enable(tabId, () => {  /* ... */ });

// 获取当前状态
chrome.action.isEnabled({tabId}, (result) => {  /* ... */ });
```


## chrome.alarms 闹钟
> 安排代码周期性地或者在将来的指定时间运行

### 权限设置

```json
"permissions": [
  "alarms"
],
```

### 检测闹钟的持续性
> 闹钟在浏览器关闭后会被清除，如果需要持续性，需要在`background.js`中重新注册

```js
// background.js
const STORAGE_KEY = "ALARM_ENABLED";
const MY_ALARM = "my-alarm";

async function checkAlarmState() {
  // 判断上次关闭浏览器时，闹钟是否开启
  const { alarmEnabled } = await chrome.storage.get(STORAGE_KEY);

  if (alarmEnabled) {
    const alarm = await chrome.alarms.get(MY_ALARM);

    if (!alarm) {
      await chrome.alarms.create({ periodInMinutes: 1 });
    }
  }
}

checkAlarmState();
```

### 方法
#### 创建闹钟
> 创建闹钟，如果已存在，则会更新
> 减少用户计算机上的负载，Chrome 将警报限制为最多每 30 秒一次

```ts
// 闹钟名字
type alarmName = string;

// 闹钟信息
// 闹钟触发时间: {when}ms时触发   /  {delayInMinutes}分钟后触发
// 闹钟周期: 每{periodInMinutes}分钟触发一次
type alarmInfo = {
  // 闹钟触发时间，单位：毫秒
  when: number;
  // x分钟后触发，单位：分钟
  delayInMinutes: number;
  // 闹钟每x分钟触发一次（when/delayInMinutes初始事件之后开始算）
  periodInMinutes: number;
}

chrome.alarms.create(alarmName, alarmInfo);
```

```js
// background.js
chrome.runtime.onInstalled.addListener(async ({ reason }) => {
  if (reason !== 'install') {
    return;
  }

  // Create an alarm so we have something to look at in the demo
  await chrome.alarms.create(MY_ALARM, {
    // 闹钟周期，单位：分钟
    periodInMinutes: 1,
    // 闹钟触发时间，单位：毫秒
    when: Date.now() + 1000 * 60 * 1,
  });
});
```


#### clear()方法
> 清除闹钟

```js
// background.js
chrome.alarms.clear(MY_ALARM, (wasCleared) => {
  console.log('🍄  background: >>>>>>>>>>>>>>>>>> 清除闹钟', Date.now(), wasCleared);
});

// 清除所有闹钟
chrome.alarms.clearAll((wasCleared) => {
  console.log('🍄  background: >>>>>>>>>>>>>>>>>> 清除所有闹钟', Date.now(), wasCleared);
});
```

#### get()方法
> 获取闹钟

```js
// background.js
chrome.alarms.get(MY_ALARM, (alarm) => {
  console.log('🍄  background: >>>>>>>>>>>>>>>>>> 获取闹钟', Date.now(), alarm);
});

// 获取所有闹钟
chrome.alarms.getAll((alarms) => {
  console.log('🍄  background: >>>>>>>>>>>>>>>>>> 获取所有闹钟', Date.now(), alarms);
});
```


### 事件
####  onAlarm事件
> 监听闹钟触发事件

```js
// background.js
chrome.alarms.onAlarm.addListener((alarm) => {
  if (alarm.name === MY_ALARM) {
    console.log('🍄  background: >>>>>>>>>>>>>>>>>> 监听闹钟触发事件', Date.now(), alarm);
  }
});
```


## chrome.contextMenus 右键菜单
[官方文档](https://developer.chrome.com/docs/extensions/reference/contextMenus)

> 允许用户添加菜单项到浏览器的右键菜单中

### 权限设置

```json
"permissions": [
  "contextMenus"
],
```

### 方法

#### create() 创建菜单项
> 创建菜单项，如果已存在，则会更新

```ts
// 菜单项信息
type menuItemInfo = {
  // 菜单项标题
  title: string;
  // 菜单项类型
  type: 'normal' | 'checkbox' | 'radio' | 'separator';
  // 菜单项图标
  iconUrl: string;
  // 菜单项是否可用
  enabled: boolean;
  // 菜单项是否可见
  visible: boolean;
  // 菜单项是否选中
  checked: boolean;
  // 菜单项子菜单
  children: menuItemInfo[];
}

chrome.contextMenus.create(menuItemInfo: menuItemInfo, callback?: function);
```

```js
// background.js
chrome.runtime.onInstalled.addListener(async ({ reason }) => {
  if (reason !== 'install') {
    return;
  }

  // Create an alarm so we have something to look at in the demo
  await chrome.contextMenus.create({
    id: 'my-menu',
    title: 'My Menu',
    type: 'normal',
    iconUrl: 'icon-48.png',
    enabled: true,
    visible: true,
    checked: false,
    children: [
      {
        id: 'my-menu-1',
        title: 'My Menu 1',
        type: 'normal',
        iconUrl: 'icon-48.png',
        enabled: true,
        visible: true,
        checked: false,
        children: [],
      },
      {
        id: 'my-menu-2',
        title: 'My Menu 2',
        type: 'normal',
        iconUrl: 'icon-48.png',
        enabled: true,
        visible: true,
        checked: false,
        children: [],
      },
    ],
  });
});
```

### 事件

#### onClicked事件
> 监听菜单项点击事件

```js
// background.js
chrome.contextMenus.onClicked.addListener((info, tab) => {
  console.log('🍄  background: >>>>>>>>>>>>>>>>>> 监听菜单项点击事件', Date.now(), info, tab);
});
```

## chrome.downloads 下载
> 启动、监视、操作和搜索下载，此权限会触发警告

### 权限设置
```json
{
  "permissions": [
    "downloads"
  ],
}
```

### 方法

#### setShelfEnabled() 设置下载栏是否可见
> 设置下载栏是否可见。底部灰色下载栏。新版本使用`setUiOptions`

```ts
chrome.downloads.setShelfEnabled(enabled: boolean, callback?: function);
```

#### download() 下载链接
> 下载文件

```ts
// 下载项信息
type downloadItemInfo = {
  // 曾下载文件的URL
  url: string;
  // 曾下载文件的文件名
  filename: string;
  // 曾下载文件的保存路径
  saveAs: boolean;
  // 曾下载文件的请求头
  headers: object[];
  // 曾下载文件的请求体
  body: object;
  // 曾下载文件的请求方法
  method: 'GET' | 'POST';
  // 曾下载文件的请求类型
  type: 'image' | 'video' | 'audio' | 'text' | 'application' | 'multipart' | 'other';
  // 曾下载文件的大小
  totalBytes: number;
  // 曾下载文件的状态
  state: 'in_progress' | 'interrupted' | 'complete';
  // 曾下载文件的状态信息
  paused: boolean;
  // 曾下载文件的错误信息
  error: string;
  // 曾下载文件的创建时间
  startTime: number;
  // 曾下载文件的结束时间
  endTime: number;
  // 曾下载文件的持续时间
  elapsedTime: number;
  // 曾下载文件的最后修改时间
  lastModified: number;
  // 曾下载文件的最后访问时间
  lastAccessed: number;
  // 曾下载文件的MIME类型
  mime: string;
  // 曾下载文件的SHA1哈希值
  sha1: string;
  // 曾下载文件的SHA256哈希值
  sha256: string;
  // 曾下载文件的MD5哈希值
  md5: string;
  // 曾下载文件的CRC32C哈希值
  crc32c: string;
  // 曾下载文件的安全状态
  danger: 'safe' | 'accepted' | 'accepted_with_warning' | 'unknown';
  // 曾下载文件的是否可恢复
  canResume: boolean;
  // 曾下载文件的是否已删除
  exists: boolean;
  // 曾下载文件的是否已打开
  opened: boolean;
  // 曾下载文件的是否已保存
  state: 'in_progress' | 'interrupted' | 'complete';
}

chrome.downloads.download(downloadItemInfo: downloadItemInfo, callback?: function);
```

```js
// background.js
chrome.downloads.download({
  url: 'https://www.baidu.com',
  filename: 'baidu.html',
  saveAs: false,
  headers: [],
  body: {},
  method: 'GET',
  type: 'text',
  totalBytes: 0,
  state: 'in_progress',
  paused: false,
  error: '',
  startTime: 0,
  endTime: 0,
  elapsedTime: 0,
  lastModified: 0,
  lastAccessed: 0,
  mime: '',
  sha1: '',
  sha256: '',
  md5: '',
  crc32c: '',
  danger: 'safe',
  canResume: false,
  exists: false,
  opened: false,
}, (downloadItem) => {
  console.log('🍄  background: >>>>>>>>>>>>>>>>>> 下载文件', Date.now(), downloadItem);
});
```

#### search() 搜索
> 搜索浏览器曾经下载过的所有文件

```ts
type DownloadQuery = {
  id: number;

  // 曾下载文件的URL
  url: string;
  urlRegex: string;
  finalUrl: string;
  finalUrlRegex: string;

  // 曾下载文件的文件名
  filename: string;
  filenameRegex: string;

  // 搜索结果的最大数量
  limit: number;

  // 搜索结果排序：orderBy = [‘ startTime’]按照开始时间升序，若要指定降序顺序，请在前缀中加上连字符: “-startTime”。
  orderBy: string[];

  // url链接参数
  query: string[];

  // 曾下载文件的状态
  state: 'in_progress' | 'interrupted' | 'complete';

  // 曾下载文件的MIME类型
  mime: string;

  // 曾下载文件的是否已删除
  exists: boolean;

  // 曾下载文件的状态信息
  paused: boolean;
  // 曾下载文件的错误信息
  error: string;

  // 曾下载文件的创建时间
  startTime: number;
  startedAfter: number;
  startedBefore: number;
  // 曾下载文件的结束时间
  endTime: number;
  endedAfter: number;
  endedBefore: number;
  // 曾下载文件的持续时间
  elapsedTime: number;
  // 曾下载文件的最后修改时间
  lastModified: number;
  // 曾下载文件的最后访问时间
  lastAccessed: number;
  // 曾下载文件的安全状态
  danger: 'safe' | 'accepted' | 'accepted_with_warning' | 'unknown';
  // 曾下载文件的大小
  fileSize: number;
  totalBytes: number;
  totalBytesGreater: number;
  totalBytesLess: number;
}
// 下载查询条件
// query: {} 查询所有
chrome.downloads.search(
  query: DownloadQuery,
  callback?: (res) => void,
)
```

```js
// background.js
chrome.downloads.search({
  limit: 100,
  orderBy: ['-startTime'],
}, (downloadItems) => {
  console.log('🍄  background: >>>>>>>>>>>>>>>>>> 搜索下载文件', Date.now(), downloadItems);
});
```

#### open() 打开文件
> 打开已下载的文件

```ts
chrome.downloads.open(
  downloadId: number,
  callback?: function,
)
```

#### pause() 暂停下载
> 暂停下载

```ts
chrome.downloads.pause(
  downloadId: number,
  callback?: function,
)
```

#### resume() 恢复下载
> 恢复下载

```ts
chrome.downloads.resume(
  downloadId: number,
  callback?: function,
)
```

#### cancel() 取消下载
> 取消下载

```ts
chrome.downloads.cancel(
  downloadId: number,
  callback?: function,
)
```

#### erase() 删除下载
> 删除下载

```ts
chrome.downloads.erase(
  query: DownloadQuery,
  callback?: function,
)
```

#### removeFile() 删除文件
> 删除文件

```ts
chrome.downloads.removeFile(
  downloadId: number,
  callback?: function,
)
```

#### acceptDanger() 接受危险
> 接受危险

```ts
chrome.downloads.acceptDanger(
  downloadId: number,
  callback?: function,
)
```

#### show() 显示下载
> 显示下载

```ts
chrome.downloads.show(
  downloadId: number,
  callback?: function,
)
```

#### getFileIcon() 获取文件图标
> 获取文件图标

```ts
chrome.downloads.getFileIcon(
  downloadId: number,
  options: {
    size: number,
  },
  callback?: function,
)
```


#### showDefaultFolder() 显示默认文件夹
> 显示默认文件夹

```ts
chrome.downloads.showDefaultFolder()
```

### 事件

#### onCreated 创建事件
> 下载项被下载时触发

```js
// background.js
chrome.downloads.onCreated.addListener((item) => {
  console.log('🍄  background: >>>>>>>>>>>>>>>>>> 监听创建事件', Date.now(), item);
});
```

#### onErased 删除事件
> 当下载项被删除时触发

```js
// background.js
chrome.downloads.onErased.addListener((item) => {
  console.log('🍄  background: >>>>>>>>>>>>>>>>>> 监听删除事件', Date.now(), item);
});
```

#### onChanged 更新事件
> 当下载项的状态发生变化时触发，例如下载完成、下载失败、下载暂停、下载恢复、下载取消等

```js
// background.js
chrome.downloads.onChanged.addListener((item) => {
  //   {
  //     "error": {
  //         "current": "USER_CANCELED"
  //     },
  //     "id": 254,
  //     "state": {
  //         "current": "interrupted",
  //         "previous": "in_progress"
  //     }
  //    }
  console.log('🍄  background: >>>>>>>>>>>>>>>>>> 监听更新事件', Date.now(), item);
});
```

#### onDeterminingFilename 取文件名事件
> 当下载项的文件名需要确定时触发

```js
// background.js
chrome.downloads.onDeterminingFilename.addListener((item, suggest) => {
  // 默认覆盖原文件名
  suggest({
    filename: item.filename,
    conflict_action: 'overwrite',
    conflictAction: 'overwrite'
  })
  console.log('🍄  background: >>>>>>>>>>>>>>>>>> 监听取文件名事件', Date.now(), item, suggest);
});
```



## chrome.notifications 通知
[官方文档](https://developer.chrome.com/docs/extensions/reference/notifications)

> 允许用户创建、显示和更新通知

### 权限设置

```json
"permissions": [
  "notifications"
],
```

:::tip  新版本Chrome浏览器禁用了MacOS本机通知
解决方案： 
1. 在Chrome浏览器中访问地址：chrome://flags。 
2. 搜索栏中搜索：notifications，找到 Enable system notifications 选项，将其选项值改为 Disabled
3. 重启浏览器，问题解决。
:::


### 方法

#### 创建通知

```ts
type NotificationOptions = {
  // 通知类型
  type: 'basic' | 'image' | 'list' | 'progress';
  // 通知图标（可以是发件人头像，应用图标等）
  iconUrl: string;
  // 通知标题
  title: string;
  // 通知内容
  message: string;
  // 通知按钮，最多两个
  buttons: {
    title: string;
  }[];
  // 通知优先级(从 -2 到 2。-2 是最低优先级。2 是最高的。默认值为零)
  priority: number;

  // 使用较低粗细字体的备用通知内容
  contextMessage: string;
  // 通知列表(Mac OS X 上的用户只能看到第一项)
  items: {
    title: string;
    message: string;
  }[];
  // 显示通知时不应发出声音或振动。默认值为 false。
  silent: boolean;
  // 通知是否可关闭
  requireInteraction: boolean;
  // 通知进度(从 0 到 100)
  progress: number;
  // 通知进度状态
  progressState: 'indeterminate' | 'error' | 'paused' | 'normal';
  // 事件时间戳（以ms为单位）
  eventTime: number;
}

chrome.notifications.create(
  notificationId: string,
  options: NotificationOptions,
  callback?: function,
)
```


#### clear() 清除通知
> 清除通知

```ts
chrome.notifications.clear(
  notificationId: string,
  callback?: function,
)
```


#### update() 更新通知
> 更新通知

```ts
chrome.notifications.update(
  notificationId: string,
  options: NotificationOptions,
  callback?: function,
)
```

#### getPermissionLevel() 获取通知权限
> 获取通知权限

```ts
chrome.notifications.getPermissionLevel(
  callback?: function,
)
```

#### getAll() 获取所有通知
> 获取所有通知

```ts
chrome.notifications.getAll(
  callback?: function,
)
```

### 事件

#### onClosed 关闭事件
> 当通知关闭时触发

```js
// background.js
chrome.notifications.onClosed.addListener((notificationId, byUser) => {
  console.log('🍄  background: >>>>>>>>>>>>>>>>>> 监听关闭事件', Date.now(), notificationId, byUser);
});
```

#### onClicked 点击事件
> 当通知被点击时触发

```js
// background.js
chrome.notifications.onClicked.addListener((notificationId) => {
  console.log('🍄  background: >>>>>>>>>>>>>>>>>> 监听点击事件', Date.now(), notificationId);
});
```


#### onButtonClicked 按钮点击事件
> 当通知按钮被点击时触发

```js
// background.js
chrome.notifications.onButtonClicked.addListener((notificationId, buttonIndex) => {
  console.log('🍄  background: >>>>>>>>>>>>>>>>>> 监听按钮点击事件', Date.now(), notificationId, buttonIndex);
});
```

#### onPermissionLevelChanged 权限级别变更事件
> 当通知权限级别变更时触发

```js
// background.js
chrome.notifications.onPermissionLevelChanged.addListener((level) => {
  console.log('🍄  background: >>>>>>>>>>>>>>>>>> 监听权限变更事件', Date.now(), level);
});
```

#### onShowSettings 显示事件
> 当通知显示时触发

```js
// background.js
chrome.notifications.onShowSettings.addListener((notificationId) => {
  console.log('🍄  background: >>>>>>>>>>>>>>>>>> 监听显示事件', Date.now(), notificationId);
});
```

## chrome.offscreen 离屏
[官方文档](https://developer.chrome.com/docs/extensions/reference/offscreen/)
> 允许用户在后台线程中创建离屏画布

### 权限设置

```json
"permissions": [
  "offscreen"
],
```

### createDocument() 创建离屏文档
> 创建离屏文档

```ts
type Reason = (
  "TESTING" |              // 测试目的
  "AUDIO_PLAYBACK" |       // 播放音频
  "IFRAME_SCRIPTING" |     // 嵌入 iframe 并编写脚本
  "DOM_SCRAPING" |         // 抓取 DOM 以提取信息
  "BLOBS" |                // 与 Blob 对象（包括 URL.createObjectURL() ）进行交互
  "DOM_PARSER" |           // 解析 DOM, new DomParser()
  "USER_MEDIA" |           // 与来自用户媒体的媒体流进行交互  getUserMedia()
  "DISPLAY_MEDIA" |        // 与来自显示媒体的媒体流进行交互（例如 getDisplayMedia() 
  "WEB_RTC" |              // RTC
  "CLIPBOARD" |            // 剪贴板
  "LOCAL_STORAGE" |        // 本地存储
  "WORKERS" |              // Web Workers
  "BATTERY_STATUS" |       // 电池状态，navigator.getBattery()
  "MATCH_MEDIA" |          // window.matchMedia
  "GEOLOCATION"            // 地理位置, navigator.geolocation()
);
type CreateParameters = {
  // 开发人员提供的字符串，更详细地解释了对后台上下文的需求
  justification?: string;
  // 用于创建离屏文档的原因，列出了应用场景
  reasons?: Reason[];

  // 相对于当前文档的URL
  url: string;
}

chrome.offscreen.createDocument(parameters:  CreateParameters,callback?: function)
```

### closeDocument() 关闭离屏文档

```ts
chrome.offscreen.closeDocument(callback?: function)
```

### 示例

#### GEO定位

```js
// background.js
chrome.action.onClicked.addListener(async () => {
  await chrome.offscreen.createDocument({
    url: '/offscreen.html',
    reasons: [
      chrome.offscreen.Reason.GEOLOCATION ||
        chrome.offscreen.Reason.DOM_SCRAPING
    ],
    justification: 'add justification for geolocation use here'
  });

  const geolocation = await chrome.runtime.sendMessage({
    type: 'get-geolocation',
    target: 'offscreen'
  });

  await chrome.offscreen.closeDocument();
  return geolocation;
});
```

```html
<!-- offscreen.html -->
<!DOCTYPE html>
<script src="offscreen.js"></script>
```

```js
// offscreen.js
chrome.runtime.onMessage.addListener((message, sender, sendResponse) => {
  if (message.target !== 'offscreen') {
    return false;
  }

  if (message.type !== 'get-geolocation') {
    console.warn(`Unexpected message type received: '${message.type}'.`);
    return;
  }

  getGeolocation().then((geolocation) => {
    console.log('getGeolocation', geolocation);
    sendResponse(geolocation)
  });
  return true;
})

function clone(obj) {
  const copy = {};
  if (obj === null || !(obj instanceof Object)) {
    return obj;
  } else {
    for (const p in obj) {
      copy[p] = clone(obj[p]);
    }
  }
  return copy;
}

async function getGeolocation() {
  return new Promise((resolve, reject) => {
    navigator.geolocation.getCurrentPosition(
      (loc) => resolve(clone(loc)),
      (err) => reject(err)
    );
  });
}
```

#### 复制粘贴

```js
// background.js
chrome.action.onClicked.addListener(async () => {
  await chrome.offscreen.createDocument({
    url: 'offscreen.html',
    reasons: [chrome.offscreen.Reason.CLIPBOARD],
    justification: 'Write text to the clipboard.'
  });

  chrome.runtime.sendMessage({
    type: 'copy-data-to-clipboard',
    target: 'offscreen-doc',
    data: value
  });
});
```

```html
<!-- offscreen.html -->
<!DOCTYPE html>
<textarea id="text"></textarea>
<script src="offscreen.js"></script>
```

```js
// offscreen.js
chrome.runtime.onMessage.addListener(async (message) => {
  if (message.target !== 'offscreen-doc') {
    return;
  }

  switch (message.type) {
    case 'copy-data-to-clipboard':
      handleClipboardWrite(message.data);
      break;
    default:
      console.warn(`Unexpected message type received: '${message.type}'.`);
  }
});

const textEl = document.querySelector('#text');

async function handleClipboardWrite(data) {
  try {
    if (typeof data !== 'string') {
      throw new TypeError(
        `Value provided must be a 'string', got '${typeof data}'.`
      );
    }
    
    textEl.value = data;
    textEl.select();
    document.execCommand('copy');
  } finally {
    window.close();
  }
}
```


#### 解析DOM

```js
// background.js
chrome.action.onClicked.addListener(async () => {
  await chrome.offscreen.createDocument({
    url: 'offscreen.html',
    reasons: [chrome.offscreen.Reason.DOM_PARSER],
    justification: 'Parse the DOM.'
  });

  const dom = await chrome.runtime.sendMessage({
    type: 'add-exclamationmarks-to-headings',
    target: 'offscreen',
    data: '<html><head></head><body><h1>Hello World</h1></body></html>'
  });

 chrome.offscreen.closeDocument();
});

chrome.runtime.onMessage.addListener(async (message) => {
  if (message.target !== 'background') {
    return;
  }

  switch (message.type) {
    case 'add-exclamationmarks-result':
      console.log('Received dom', message.data);
      chrome.offscreen.closeDocument();
      break;
    default:
      console.warn(`Unexpected message type received: '${message.type}'.`);
  }
});
```

```html
<!-- offscreen.html -->
<!DOCTYPE html>
<script src="offscreen.js"></script>
```

```js
// offscreen.js
chrome.runtime.onMessage.addListener(async (message) => {
  if (message.target !== 'offscreen') {
    return;
  }

  switch (message.type) {
    case 'add-exclamationmarks-to-headings':
      cconst parser = new DOMParser();
      const document = parser.parseFromString(htmlString, 'text/html');
      document.querySelectorAll('h1').forEach((heading) => (heading.textContent = heading.textContent + '!!!'));
      chrome.runtime.sendMessage({
        type: 'add-exclamationmarks-result',
        target: 'background',
        data: document.documentElement.outerHTML
      });
      break;
    default:
      console.warn(`Unexpected message type received: '${message.type}'.`);
  }
});
```

#### 网页录制

```js
// background.js
chrome.action.onClicked.addListener(async (tab) => {
  const existingContexts = await chrome.runtime.getContexts({});
  let recording = false;

  const offscreenDocument = existingContexts.find(
    (c) => c.contextType === 'OFFSCREEN_DOCUMENT'
  );

  // If an offscreen document is not already open, create one.
  if (!offscreenDocument) {
    // Create an offscreen document.
    await chrome.offscreen.createDocument({
      url: 'offscreen.html',
      reasons: ['USER_MEDIA'],
      justification: 'Recording from chrome.tabCapture API'
    });
  } else {
    recording = offscreenDocument.documentUrl.endsWith('#recording');
  }

  if (recording) {
    chrome.runtime.sendMessage({
      type: 'stop-recording',
      target: 'offscreen'
    });
    chrome.action.setIcon({ path: 'icons/not-recording.png' });
    return;
  }

  // Get a MediaStream for the active tab.
  const streamId = await chrome.tabCapture.getMediaStreamId({
    targetTabId: tab.id
  });

  // Send the stream ID to the offscreen document to start recording.
  chrome.runtime.sendMessage({
    type: 'start-recording',
    target: 'offscreen',
    data: streamId
  });

  chrome.action.setIcon({ path: '/icons/recording.png' });
});
```


```html
<!-- offscreen.html -->
<!DOCTYPE html>
<script src="offscreen.js"></script>
```

```js
// offscreen.js
chrome.runtime.onMessage.addListener(async (message) => {
  if (message.target === 'offscreen') {
    switch (message.type) {
      case 'start-recording':
        startRecording(message.data);
        break;
      case 'stop-recording':
        stopRecording();
        break;
      default:
        throw new Error('Unrecognized message:', message.type);
    }
  }
});

let recorder;
let data = [];

async function startRecording(streamId) {
  if (recorder?.state === 'recording') {
    throw new Error('Called startRecording while recording is in progress.');
  }

  const media = await navigator.mediaDevices.getUserMedia({
    audio: {
      mandatory: {
        chromeMediaSource: 'tab',
        chromeMediaSourceId: streamId
      }
    },
    video: {
      mandatory: {
        chromeMediaSource: 'tab',
        chromeMediaSourceId: streamId
      }
    }
  });

  const output = new AudioContext();
  const source = output.createMediaStreamSource(media);
  source.connect(output.destination);

  recorder = new MediaRecorder(media, { mimeType: 'video/webm' });
  recorder.ondataavailable = (event) => data.push(event.data);
  recorder.onstop = () => {
    const blob = new Blob(data, { type: 'video/webm' });
    window.open(URL.createObjectURL(blob), '_blank');

    recorder = undefined;
    data = [];
  };
  recorder.start();

  window.location.hash = 'recording';
}

async function stopRecording() {
  recorder.stop();

  recorder.stream.getTracks().forEach((t) => t.stop());

  window.location.hash = '';
}
```

## chrome.permissions 权限
[官方文档](https://developer.chrome.com/docs/extensions/reference/permissions)

> 针对声明的可选权限(`optional_permissions`)； ———— 请求授予扩展程序某些权限(`request`)
> 针对已授予的权限(`permissions`):
> 1. 查询当前扩展程序是否具有某些权限(`contains`)
> 2. 移除已授予的权限(`remove`)；移除所有已授予的权限(`removeAll`)；
> 3. 监听权限变更(`onAdded`、`onRemoved`)

### 方法

#### contains() 查询权限
> 查询当前扩展程序是否具有某些权限

```ts
type Permissions = {
  permissions: string[];
  origins?: string[];
}
chrome.permissions.contains(
  permissions: Permissions,
  callback?: function,
)
```

#### request() 请求权限
> 请求授予扩展程序某些权限，需要在`manifest.json`中声明`optional_permissions`

```json
{
  "optional_permissions": [
    // ...
  ]
}
```

```ts
type Permissions = {
  permissions: string[];
  origins?: string[];
}
chrome.permissions.request(
  permissions: Permissions,
  callback?: function,
)
```

#### remove() 移除权限
> 移除已授予的权限

```ts
type Permissions = {
  permissions: string[];
  origins?: string[];
}
chrome.permissions.remove(
  permissions: Permissions,
  callback?: function,
)
```

#### removeAll() 移除所有权限
> 移除所有已授予的权限

```ts
chrome.permissions.removeAll(
  callback?: function,
)
```

#### getAll() 获取所有权限
> 获取所有已授予的权限

```ts
chrome.permissions.getAll(
  callback?: function,
)
```


### 事件

#### onAdded 添加事件
> 当权限被添加时触发

```js
// background.js
chrome.permissions.onAdded.addListener((permissions) => {
  console.log('🍄  background: >>>>>>>>>>>>>>>>>> 监听添加事件', Date.now(), permissions);
});
```

#### onRemoved 移除事件
> 当权限被移除时触发

```js
// background.js
chrome.permissions.onRemoved.addListener((permissions) => {
  console.log('🍄  background: >>>>>>>>>>>>>>>>>> 监听移除事件', Date.now(), permissions);
});
```


## chrome.cookies cookie
[官方文档](https://developer.chrome.com/docs/extensions/reference/cookies)

> 允许用户创建、获取、删除、查询cookie

```json
"permissions": [
  "cookies"
]
```

### 方法

#### 增
```ts
chrome.cookies.set(
  details: object,
  callback?: function,
)
```

```js
chrome.cookies.set({
  url: 'https://www.baidu.com',
  name: 'name',
  value: 'value',
  domain: 'baidu.com',
  path: '/',
  secure: true,
  httpOnly: true,
  expirationDate: Date.now() + 1000 * 60 * 60 * 24 * 365 * 10,
}, (cookie) => {
  console.log('🍄  background: >>>>>>>>>>>>>>>>>> 创建cookie', Date.now(), cookie);
});
```

#### 删
```ts
chrome.cookies.remove(
  details: object,
  callback?: function,
)
```

```js
chrome.cookies.remove({
  url: 'https://www.baidu.com',
  name: 'name',
}, (cookie) => {
  console.log('🍄  background: >>>>>>>>>>>>>>>>>> 删除cookie', Date.now(), cookie);
});
```

#### 改
```ts
chrome.cookies.set(
  details: object,
  callback?: function,
)
```

```js
chrome.cookies.set({
  url: 'https://www.baidu.com',
  name: 'name',
  value: 'value',
  domain: 'baidu.com',
  path: '/',
  secure: true,
  httpOnly: true,
  expirationDate: Date.now() + 1000 * 60 * 60 * 24 * 365 * 10,
}, (cookie) => {
  console.log('🍄  background: >>>>>>>>>>>>>>>>>> 创建cookie', Date.now(), cookie);
});
```

#### 查
```ts
chrome.cookies.get(
  details: object,
  callback?: function,
)
```

```js
chrome.cookies.get({
  url: 'https://www.baidu.com',
  name: 'name',
}, (cookie) => {
  console.log('🍄  background: >>>>>>>>>>>>>>>>>> 获取cookie', Date.now(), cookie);
});

chrome.cookies.getAll({
  url: 'https://www.baidu.com',
}, (cookie) => {
  console.log('🍄  background: >>>>>>>>>>>>>>>>>> 获取所有cookie', Date.now(), cookie);
});
```


## 其它

### chrome.extension 扩展功能
> 此api大多数方法都合并到`chrome.runtime`


## chrome.proxy 代理
[官方文档](https://developer.chrome.com/docs/extensions/reference/proxy/)
> 允许用户配置和控制代理设置


### 权限设置

```json
{
  "permissions": [
    "proxy"
  ],
}
```

### 方法

#### get() 获取代理设置
> 获取代理设置

```ts
chrome.proxy.settings.get(
  callback: function,
)
```

#### set() 设置代理设置
> 设置代理设置

```ts
chrome.proxy.settings.set(
  details: object,
  callback?: function,
)
```

#### clear() 清除代理设置
> 清除代理设置

```ts
chrome.proxy.settings.clear(
  details: object,
  callback?: function,
)
```


### chrome.printerProvider/printing/printingMetrics 打印机相关
[官方文档](https://developer.chrome.com/docs/extensions/reference/printerProvider)

### chrome.fontSetting 设置Chrome字体
[官方文档](https://developer.chrome.com/docs/extensions/reference/fontSettings)

### chrome.commands 快捷键设置与监听
[官方文档](https://developer.chrome.com/docs/extensions/reference/commands)

> 允许用户设置和监听浏览器命令

```json
"commands": {
  "toggle-feature-foo": {
    "suggested_key": {
      "default": "Ctrl+Shift+Y",
      "mac": "Command+Shift+Y"
    },
    "description": "Toggle feature foo"
  }
}
```

```js
// 监听快捷键
chrome.commands.onCommand.addListener((command) => {
  console.log(`Command: ${command}`);
});
```

### chrome.contentSettings 内容设置
[官方文档](https://developer.chrome.com/docs/extensions/reference/contentSettings)

> 允许用户控制网站内容设置

```json
"permissions": [
  "contentSettings"
]
```

### chrome.bookmarks书签
[官方文档](https://developer.chrome.com/docs/extensions/reference/bookmarks)
> 允许用户创建、组织和以其他方式操作书签

```json
"permissions": [
  "bookmarks"
]
```

#### 增
```ts
chrome.bookmarks.create(
  bookmark: CreateDetails,
  callback?: function,
)
```

```js
chrome.bookmarks.create(
  {
    'parentId': extensionsFolderId,
    'title': 'Extensions doc',
    'url': 'https://developer.chrome.com/docs/extensions',
  },
  function(newFolder) {
    console.log("added folder: " + newFolder.title);
  },
);
```

#### 删
```ts
chrome.bookmarks.remove(
  id: string,
  callback?: function,
)

// 递归删除书签文件夹
chrome.bookmarks.removeTree(
  id: string,
  callback?: function,
)
```


#### 改
```ts
// 移动
chrome.bookmarks.move(
  id: string,
  destination: {
    index?: number, parentId?:string 
  },
  callback?: function,
)

// 更新
chrome.bookmarks.update(
  id: string,
  changes: object,
  callback?: function,
)
```

#### 查
```ts
// 获取单个
chrome.bookmarks.get(
  idOrIdList: string | string[],
  callback: function,
)

// 获取所有
chrome.bookmarks.getTree(
  callback: function,
)

// 获取子节点
chrome.bookmarks.getChildren(
  id: string,
  callback: function,
)

// 获取最近添加的书签
chrome.bookmarks.getRecent(
  numberOfItems: number,
  callback: function,
)

// 搜索
chrome.bookmarks.search(
  query: string,
  callback: function,
)
```

#### 事件
```ts
// 监听书签创建事件
chrome.bookmarks.onCreated.addListener(function(id, bookmark) {
  console.log("created bookmark: " + bookmark.title);
});

// 监听书签移动事件
chrome.bookmarks.onMoved.addListener(function(id, moveInfo) {
  console.log("moved bookmark: " + moveInfo.title);
});

// 监听书签更新事件
chrome.bookmarks.onChanged.addListener(function(id, changeInfo) {
  console.log("changed bookmark: " + changeInfo.title);
});

// 监听书签删除事件
chrome.bookmarks.onRemoved.addListener(function(id, removeInfo) {
  console.log("removed bookmark: " + removeInfo.title);
});

// 监听书签导入事件
chrome.bookmarks.onImportBegan.addListener(function() {
  console.log("beginning import");
});

// 监听书签导入完成事件
chrome.bookmarks.onImportEnded.addListener(function() {
  console.log("ending import");
});

// 监听重新排序事件
chrome.bookmarks.onChildrenReordered.addListener(function(id, reorderInfo) {
  console.log("reordered bookmark: " + reorderInfo.title);
});
```

### chrome.audio 音频
[官方文档](https://developer.chrome.com/docs/extensions/reference/api/audio)

> 允许用户获取连接到系统的音频设备信息, 可能可以做音频分离控制？？

### chrome.browsingData 浏览数据
[官方文档](https://developer.chrome.com/docs/extensions/reference/browsingData)

> 允许用户删除浏览器的历史记录、下载记录、缓存、cookie等

```js
// 删除浏览器数据
chrome.browsingData.remove(
  { since: removal_start },
  {
    appcache: true,
    cache: true,
    cacheStorage: true,
    cookies: true,
    downloads: true,
    fileSystems: true,
    formData: true,
    history: true,
    indexedDB: true,
    localStorage: true,
    serverBoundCertificates: true,
    serviceWorkers: true,
    pluginData: true,
    passwords: true,
    webSQL: true
  }
);
```

### chrome.history 历史记录
[官方文档](https://developer.chrome.com/docs/extensions/reference/history)


### chrome.omnibox 地址栏
[官方文档](https://developer.chrome.com/docs/extensions/reference/omnibox)
![地址栏](https://developer.chrome.com/static/docs/extensions/reference/api/images/omnibox.png)

### chrome.identity 身份验证
[官方文档](https://developer.chrome.com/docs/extensions/reference/identity)


### chrome.idle 空闲
[官方文档](https://developer.chrome.com/docs/extensions/reference/idle)


### chrome.i18n 国际化
[官方文档](https://developer.chrome.com/docs/extensions/reference/i18n)


### chrome.certificateProvider 证书提供者
[官方文档](https://developer.chrome.com/docs/extensions/reference/certificateProvider)

> 允许用户管理证书


### chrome.debugger 调试器
[官方文档](https://developer.chrome.com/docs/extensions/reference/debugger)

> 允许用户管理浏览器调试器


### chrome.input.ime 自定义输入法
[官方文档](https://developer.chrome.com/docs/extensions/reference/input_ime)

### chrome.gcm Google云消息
[官方文档](https://developer.chrome.com/docs/extensions/reference/gcm)

### chrome.readingList 阅读列表
[官方文档](https://developer.chrome.com/docs/extensions/reference/readingList)
> Chrome 120 测试版中可用

### chrome.search 搜索
[官方文档](https://developer.chrome.com/docs/extensions/reference/search)

### chrome.sessions 会话
[官方文档](https://developer.chrome.com/docs/extensions/reference/sessions)



### chrome.system.cpu 系统CPU
[官方文档](https://developer.chrome.com/docs/extensions/reference/system_cpu)

### chrome.system.memory 系统内存
[官方文档](https://developer.chrome.com/docs/extensions/reference/system_memory)

### chrome.system.storage 系统存储
[官方文档](https://developer.chrome.com/docs/extensions/reference/system_storage)

### chrome.system.display 系统显示
[官方文档](https://developer.chrome.com/docs/extensions/reference/system_display)

